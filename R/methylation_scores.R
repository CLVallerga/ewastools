#' Various methylation scores
#' 
#' 
#' @rdname "Methylation scores"
#' @param beta matrix of beta values
#' @param model Name of the model, i.e., one of `maternal_smoking`, `gestational_age`, or `horvath_clock`
#' 
methylation_score = function(beta,model){
	if(model=="maternal_smoking"){

		### model based on Table S5 from Reese et al. (2017) available at doi.org/10.1289/EHP333
		markers = data.table(
			 probe_id = c("cg02256631","cg02482603","cg04103532","cg04180046","cg04506190","cg05549655","cg05575921","cg08698721","cg09743950","cg10799846","cg12186702","cg13834112","cg13893782","cg14179389","cg14351425","cg14633298","cg14743346","cg17397069","cg19381766","cg22154659","cg22802102","cg23304605","cg25189904","cg25949550","cg26764244","cg27291468")
			,coef = c(-0.191,2.706,1.786,14.027,2.318,6.210,-10.909,1.142,-6.330,-4.963,3.847,1.514,-0.963,-6.304,6.361,5.050,2.286,-2.912,5.245,-0.773,-0.254,0.011,-3.903,-46.991,-0.246,0.836)
			)

		i = match(markers$probe_id,rownames(beta))
		y = beta[i,]
		y = y * markers$coef
		y = colSums(y,na.rm=TRUE)
		return(y)

	}else if(model=="cord_blood:gestational_age"){

		### model based on doi.org/10.1186/s13059-016-1068-z
		markers = data.table(
			 probe_id = c("cg00022866","cg00466249","cg00546897","cg00575744","cg00689340","cg01056568","cg01184449","cg01348086","cg02100629","cg02813863","cg02941816","cg03086857","cg03427564","cg03506489","cg03923277","cg04001333","cg04323187","cg05294455","cg05365729","cg05512756","cg05564251","cg05898102","cg06049972","cg06311778","cg06471905","cg07017706","cg07141002","cg07197059","cg07664183","cg07679836","cg07747299","cg07816074","cg07922606","cg07955887","cg08170622","cg08251399","cg08723608","cg08888956","cg08899632","cg09011597","cg09539538","cg09594841","cg09616556","cg09730361","cg09881855","cg09904573","cg09971646","cg10459515","cg10927536","cg11299964","cg11303670","cg11469321","cg11647681","cg11777321","cg12340144","cg12478809","cg12601987","cg12721546","cg12741488","cg13129046","cg13264741","cg13269407","cg13514050","cg13686115","cg13696887","cg13954292","cg14348532","cg14659547","cg14672994","cg14732136","cg14758413","cg15357945","cg15526708","cg15856055","cg16254764","cg16270890","cg16301617","cg16442715","cg16536918","cg16545105","cg16664233","cg16990174","cg17305187","cg17317962","cg17339202","cg17451138","cg18236477","cg18487515","cg18669381","cg19070798","cg19148051","cg19257200","cg19286604","cg19403023","cg19403377","cg19486271","cg19564877","cg19766460","cg20176532","cg20277670","cg20278498","cg20394284","cg20469837","cg20512303","cg20588045","cg20815063","cg20937139","cg21207436","cg21468416","cg21549639","cg21601405","cg21926612","cg22035229","cg22151768","cg22402007","cg22580512","cg22820108","cg22972055","cg23222573","cg23355492","cg23521281","cg23580000","cg23858360","cg24030425","cg24134767","cg24620905","cg24794433","cg25169784","cg25193494","cg25306927","cg25358289","cg25374854","cg25400358","cg25511429","cg25604883","cg25651505","cg25945961","cg26060255","cg26179948","cg26385222","cg26394940","cg26656135","cg26689483","cg26884581","cg27210390","cg27258399","cg27431150","cg27544190")
			,coef = c(0.693552169,-0.825574907,-1.358515557,-3.829285657,0.960342616,0.205166173,0.782781706,-1.315722727,0.559208809,-1.065914374,1.355500313,1.099332738,-7.938111565,6.338893288,-0.336962392,-0.093610635,1.993035008,2.188729266,0.700550879,0.264360849,-0.855402625,-1.3309569,1.640250703,-4.172684301,0.155757134,-4.798856484,-0.166761117,0.092052835,-3.191022778,0.048825453,-0.001115378,-0.982600076,0.766205564,2.794444606,0.200090638,0.355638781,-0.78886985,0.057371273,2.906628076,-3.147386559,1.055321608,0.379085183,-0.1960819,3.512797132,-0.111788311,0.960375231,0.87675008,-3.163295415,-2.993350142,1.536460205,-1.222846734,1.805753988,1.088728778,-0.801064552,0.877303135,-0.016394429,8.418588312,-5.872531669,-1.705814489,-0.064280083,-1.563323217,0.368568647,2.292804952,4.978967999,-0.625612247,7.16945569,13.45987632,-4.227163144,-3.760459611,0.64750176,0.313660196,0.019686166,-2.999365611,-4.452530097,-5.91812029,-1.070681367,-5.195070106,-1.369257073,-0.750313563,-7.204881555,1.857173314,1.153497867,2.244288246,-13.06724894,-0.227341696,3.180467926,0.951387452,-3.968759927,0.704641097,-12.12924468,-3.423732456,0.041137776,0.475874231,0.260764446,0.589526246,-0.534061458,0.543472704,-1.151873469,2.119057171,1.970077542,-13.88750393,-2.292446143,4.238130341,0.893799538,1.027789989,-0.409622944,-14.88553648,2.068573497,-2.737499267,1.433242773,-0.841887494,0.444273606,0.482716795,-1.897281712,0.331076939,-0.723972763,-1.362635865,-0.005074822,-5.206244781,1.443656646,-3.750678617,-4.440709491,0.62324792,1.343272626,3.291432496,0.113282247,-1.403867628,0.889869441,0.266684995,2.819112031,-0.051653012,0.992417171,-1.741659991,4.363323248,2.441394418,-4.143863371,10.44277414,-0.038157166,-12.10898331,2.171892794,-0.219667516,-8.02120804,0.004899036,1.013812162,1.79852676,0.348045155,-0.207052492,1.584096905)
			)

		i = match(markers$probe_id,rownames(beta))
		y = beta[i,]
		y = y * markers$coef
		y = colSums(y,na.rm=TRUE)
		y = y + 41.72579759
		return(y)

	}else if(model=="placenta:gestational_age"){

		### https://doi.org/10.18632/aging.102049
		markers = system.file(paste0("data/102049-SupFile1.csv"),package="ewastools")
		markers = fread(markers)
		setnames(markers,1:2,c("probe_id","coef"))
		markers = markers[-1]

		i = match(markers$probe_id,rownames(beta))
		y = beta[i,]
		y = y * markers$coef
		y = colSums(y,na.rm=TRUE)
		y = y + 24.99772133
		return(y)

	}else if(model=="horvath_clock"){

		### model based on https://doi.org/10.1186/gb-2013-14-10-r115
		markers = system.file(paste0("data/horvath_clock.csv"),package="ewastools")
		markers = fread(markers,header=TRUE)
		i = match(markers$probe_id,rownames(beta))
		y = beta[i,]
		y = y * markers$coef
		y = colSums(y,na.rm=TRUE)
		y = y + 0.695507258

		inverse_transformation <- function(x,adult.age=20) { ifelse(x<0, (1+adult.age)*exp(x)-1, (1+adult.age)*x+adult.age) }

		return(inverse_transformation(y))

	}else return(NULL)

}
